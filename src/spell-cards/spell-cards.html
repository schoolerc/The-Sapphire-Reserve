<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="/bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="/bower_components/paper-item/paper-item.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/neon-animation/neon-animatable-behavior.html">
<link rel="import" href="/bower_components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="/bower_components/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="/bower_components/iron-list/iron-list.html">
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="spell-card.html">
<dom-module id="spell-cards">
    <template>
        <style include="iron-flex"></style>
        <style>
            :host {
                height:100vh;
                display: flex;
                flex-direction:column;
            }

            iron-list{
                flex: 1 1 auto;
            }

            paper-toolbar {
                font-weight: 500;
                font-size: 18px;
                background-color: transparent;
                color: #000000;
            }

            div > paper-input {
                margin-right: 5px;
                margin-left: 5px;
            }

            div > paper-dropdown-menu {
                margin-right: 5px;
                margin-left: 5px;
            }
        </style>
        <div>
            <!--<div class="layout horizontal wrap">
                <paper-dropdown-menu label="Class" class="flex-auto">
                    <paper-listbox multi attr-for-selected="name" class="dropdown-content"
                                   selected-values="{{playerClasses}}">
                        <paper-item name="Bard">Bard</paper-item>
                        <paper-item name="Cleric">Cleric</paper-item>
                        <paper-item name="Druid">Druid</paper-item>
                        <paper-item name="Paladin">Paladin</paper-item>
                        <paper-item name="Ranger">Ranger</paper-item>
                        <paper-item name="Sorcerer">Sorcerer</paper-item>
                        <paper-item name="Warlock">Warlock</paper-item>
                        <paper-item name="Wizard">Wizard</paper-item>
                    </paper-listbox>
                </paper-dropdown-menu>
                <paper-dropdown-menu label="School" class="flex-auto">
                    <paper-listbox multi class="dropdown-content" attr-for-selected="name"
                                   selected-values="{{spellSchools}}">
                        <paper-item name="Abjuration">Abjuration</paper-item>
                        <paper-item name="Conjuration">Conjuration</paper-item>
                        <paper-item name="Divination">Divination</paper-item>
                        <paper-item name="Enchantment">Enchantment</paper-item>
                        <paper-item name="Evocation">Evocation</paper-item>
                        <paper-item name="Illusion">Illusion</paper-item>
                        <paper-item name="Necromancy">Necromancy</paper-item>
                        <paper-item name="Transmutation">Transmutation</paper-item>
                    </paper-listbox>
                </paper-dropdown-menu>
                <paper-dropdown-menu label="Level" class="flex-auto">
                    <paper-listbox multi class="dropdown-content" attr-for-selected="level"
                                   selected-values="{{spellLevels}}">
                        <paper-item level="0">Cantrip</paper-item>
                        <paper-item level="1">1st-level</paper-item>
                        <paper-item level="2">2nd-level</paper-item>
                        <paper-item level="3">3rd-level</paper-item>
                        <paper-item level="4">4th-level</paper-item>
                        <paper-item level="5">5th-level</paper-item>
                        <paper-item level="6">6th-level</paper-item>
                        <paper-item level="7">7th-level</paper-item>
                        <paper-item level="8">8th-level</paper-item>
                        <paper-item level="9">9th-level</paper-item>
                    </paper-listbox>
                </paper-dropdown-menu>
                <paper-input label="Name" value="{{spellName}}" class="flex-auto"></paper-input>
            </div>
            <div class="layout horizontal">
                <paper-button raised noink on-tap="applyFilters">Apply Filters</paper-button>
                <paper-button raised noink on-tap="clearFilters">Clear Filters</paper-button>
            </div>-->
            <iron-ajax url="/data.json" last-response="{{data}}" auto></iron-ajax>
                <iron-list items="[[data.spells]]">
                    <template>
                        <spell-card data="[[item]]"></spell-card>
                    </template>
                </iron-list>
        </div>
    </template>

    <script>
        Polymer({
            is: 'spell-cards',

            properties: {
                playerClasses: {
                    type: Array
                },
                spellLevels: {
                    type: Array
                },
                spellSchools: {
                    type: Array
                },
                spellName: {
                    type: String
                },
                spells: {
                    type: Array,
                    notify: true,
                    value: []
                }
            },


            components: function (spell) {
                var cmpts = spell.components.join(', ');
                if (spell.material !== undefined) {
                    cmpts += ' (' + spell.material + ')';
                }
                return cmpts;
            },

            spellLevelSchoolDescription: function (spell) {
                var desc = "";
                if (spell.level == 0) {
                    desc = spell.school + " Cantrip";
                }
                else if (spell.level == 1) {
                    desc = "1st-level " + spell.school;
                }
                else if (spell.level == 2) {
                    desc = "2nd-level " + spell.school;
                }
                else if (spell.level == 3) {
                    desc = "3rd-level " + spell.school;
                }
                else {
                    desc = spell.level + "th-level " + spell.school;
                }

                if (spell.ritual) {
                    desc += " (ritual)";
                }
                return desc;
            },

            behaviors: [Polymer.NeonAnimatableBehavior],

            ready: function () {

            },
            applyFilters: function (e) {
                this.$.spellList.render();
            },

            clearFilters: function (e) {
                this.spellLevels = [];
                this.playerClasses = [];
                this.spellSchools = [];
                this.spellName = "";
                this.$.spellList.render();
            },


            filterSpell: function (spell) {
                var classMatches = true;
                if (this.playerClasses !== undefined && this.playerClasses.length > 0) {
                    classMatches = false;
                    this.playerClasses.forEach(function (item, index, array) {
                        if (spell.class.indexOf(item) !== -1) {
                            classMatches = true;
                        }
                    });
                }

                var levelMatches = true;
                if (this.spellLevels !== undefined && this.spellLevels.length > 0) {
                    levelMatches = false;
                    this.spellLevels.forEach(function (item, index, array) {
                        if (spell.level === parseInt(item)) {
                            levelMatches = true;
                        }
                    });
                }

                var schoolMatches = true;
                if (this.spellSchools !== undefined && this.spellSchools.length > 0) {
                    schoolMatches = false;
                    this.spellSchools.forEach(function (item, index, array) {
                        if (spell.school === item) {
                            schoolMatches = true;
                        }
                    });
                }

                var nameOverlaps = true;
                if (this.spellName !== undefined && this.spellName.length > 0) {
                    nameOverlaps = spell.name.toLowerCase().indexOf(this.spellName.toLowerCase()) >= 0;
                }

                return classMatches && levelMatches && schoolMatches && nameOverlaps;
            },

            sortSpells: function (a, b) {
                return a.name.localeCompare(b.name)
            }
        });
    </script>
</dom-module>